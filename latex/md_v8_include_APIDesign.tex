\section*{Overview}

The V8 public C++ A\+PI aims to support four use cases\+:


\begin{DoxyEnumerate}
\item Enable applications that embed V8 (called the embedder) to configure and run one or more instances of V8.
\item Expose E\+C\+M\+A\+Script-\/like capabilities to the embedder.
\item Enable the embedder to interact with E\+C\+M\+A\+Script by exposing A\+PI objects.
\item Provide access to the V8 debugger (inspector).
\end{DoxyEnumerate}

\section*{Configuring and running an instance of V8}

V8 requires access to certain O\+S-\/level primitives such as the ability to schedule work on threads, or allocate memory.

The embedder can define how to access those primitives via the \mbox{\hyperlink{classv8_1_1Platform}{v8\+::\+Platform}} interface. While V8 bundles a basic implementation, embedders are highly encouraged to implement \mbox{\hyperlink{classv8_1_1Platform}{v8\+::\+Platform}} themselves.

Currently, the \mbox{\hyperlink{classv8_1_1ArrayBuffer_1_1Allocator}{v8\+::\+Array\+Buffer\+::\+Allocator}} is passed to the \mbox{\hyperlink{classv8_1_1Isolate}{v8\+::\+Isolate}} factory method, however, conceptually it should also be part of the \mbox{\hyperlink{classv8_1_1Platform}{v8\+::\+Platform}} since all instances of V8 should share one allocator.

Once the \mbox{\hyperlink{classv8_1_1Platform}{v8\+::\+Platform}} is configured, an \mbox{\hyperlink{classv8_1_1Isolate}{v8\+::\+Isolate}} can be created. All further interactions with V8 should explicitly reference the \mbox{\hyperlink{classv8_1_1Isolate}{v8\+::\+Isolate}} they refer to. All A\+PI methods should eventually take an \mbox{\hyperlink{classv8_1_1Isolate}{v8\+::\+Isolate}} parameter.

When a given instance of V8 is no longer needed, it can be destroyed by disposing the respective \mbox{\hyperlink{classv8_1_1Isolate}{v8\+::\+Isolate}}. If the embedder wishes to free all memory associated with the \mbox{\hyperlink{classv8_1_1Isolate}{v8\+::\+Isolate}}, it has to first clear all global handles associated with that \mbox{\hyperlink{classv8_1_1Isolate}{v8\+::\+Isolate}}.

\section*{E\+C\+M\+A\+Script-\/like capabilities}

In general, the C++ A\+PI shouldn\textquotesingle{}t enable capabilities that aren\textquotesingle{}t available to scripts running in V8. Experience has shown that it\textquotesingle{}s not possible to maintain such A\+PI methods in the long term. However, capabilities also available to scripts, i.\+e., ones that are defined in the E\+C\+M\+A\+Script standard are there to stay, and we can safely expose them to embedders.

The C++ A\+PI should also be pleasant to use, and not require learning new paradigms. Similarly to how the A\+PI exposed to scripts aims to provide good ergonomics, we should aim to provide a reasonable developer experience for this A\+PI surface.

E\+C\+M\+A\+Script makes heavy use of exceptions, however, V8\textquotesingle{}s C++ code doesn\textquotesingle{}t use C++ exceptions. Therefore, all A\+PI methods that can throw exceptions should indicate so by returning a \mbox{\hyperlink{classv8_1_1Maybe}{v8\+::\+Maybe}}$<$$>$ or \mbox{\hyperlink{classv8_1_1MaybeLocal}{v8\+::\+Maybe\+Local}}$<$$>$ result, and by taking a \mbox{\hyperlink{classv8_1_1Local}{v8\+::\+Local}}$<$\mbox{\hyperlink{classv8_1_1Context}{v8\+::\+Context}}$>$ parameter that indicates in which context a possible exception should be thrown.

\section*{A\+PI objects}

V8 allows embedders to define special objects that expose additional capabilities and A\+P\+Is to scripts. The most prominent example is exposing the H\+T\+ML D\+OM in Blink. Other examples are e.\+g. node.\+js. It is less clear what kind of capabilities we want to expose via this A\+PI surface. As a rule of thumb, we want to expose operations as defined in the Web\+I\+DL and H\+T\+ML spec\+: we assume that those requirements are somewhat stable, and that they are a superset of the requirements of other embedders including node.\+js.

Ideally, the A\+PI surfaces defined in those specs hook into the E\+C\+M\+A\+Script spec which in turn guarantees long-\/term stability of the A\+PI.

\section*{The V8 inspector}

All debugging capabilities of V8 should be exposed via the inspector protocol. 